{"config":{"lang":["en"],"separator":"[\\s\\u200b\\-_,:!=\\[\\]()\"`/]+|\\.(?!\\d)|&[lg]t;|(?!\\b)(?=[A-Z][a-z])","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":"tillo-platform-helm-library  <p>Welcome to the tillo platform helm library, this is an extended version of the bjw-s common chart, where we have incorporated a number of Custom Resource Definitions.</p>"},{"location":"#installation","title":"Installation","text":"<p>Helm must be installed to use the charts in this repository.</p> <p>The Helm repository can be installed as follows:</p> <pre><code>helm repo add tillo-library https://TilloTech.github.io/tillo-platform-helm-library\n</code></pre> <p>You can then run <code>helm search repo tillo-library</code> to search the charts.</p>"},{"location":"#docs","title":"\ud83d\udcd6 Docs","text":"<p>The documentation that goes along with this repo can be found over here.</p>"},{"location":"#contributing","title":"Contributing","text":"<p>If you wish to contribute to this repository, take a look at the contributing instructions.</p>"},{"location":"#license","title":"\ud83d\udd0f License","text":"<p>See LICENSE</p>"},{"location":"app-template/","title":"App Template","text":""},{"location":"app-template/#background","title":"Background","text":"<p>Since Helm library charts cannot be installed directly I have created a companion chart for the common library.</p>"},{"location":"app-template/#usage","title":"Usage","text":"<p>This Helm chart can be used to deploy any application. Knowing the specifics of the application you want to deploy like the image, ports, env vars, args, and/or any config volumes will be required.</p> <p>In order to use this template chart, you would deploy it as you would any other Helm chart. By setting the desired values, the common library chart will render the desired resources.</p> <p>Be sure to check out the common library docs and its <code>values.yaml</code> for more information about the available configuration options.</p>"},{"location":"app-template/#examples","title":"Examples","text":"<p>This is an example <code>values.yaml</code> file that would deploy the vaultwarden application. For more deployment examples, check out the <code>examples</code> folder.</p> <pre><code>---\n# yaml-language-server: $schema=https://raw.githubusercontent.com/TilloTech/tillo-platform-helm-library/app-template-4.5.0/charts/other/app-template/values.schema.json\n\ncontrollers:\n  main:\n    strategy: Recreate\n\n    containers:\n      main:\n        image:\n          # -- image repository\n          repository: vaultwarden/server\n          # -- image tag\n          # this example is not automatically updated, so be sure to use the latest image\n          tag: 1.25.2\n          # -- image pull policy\n          pullPolicy: IfNotPresent\n\n        # -- environment variables.\n        # See [image docs](https://github.com/dani-garcia/vaultwarden/blob/main/.env.template) for more details.\n        env:\n          # -- Config dir\n          DATA_FOLDER: \"config\"\n\n# -- Configures service settings for the chart.\nservice:\n  main:\n    controller: main\n    ports:\n      http:\n        port: 80\n      websocket:\n        enabled: true\n        port: 3012\n\ningress:\n  # -- Enable and configure ingress settings for the chart under this key.\n  main:\n    hosts:\n      - host: chart-example.local\n        paths:\n          - path: /\n            pathType: Prefix\n            service:\n              identifier: main\n              port: http\n          - path: /notifications/hub/negotiate\n            pathType: Prefix\n            service:\n              identifier: main\n              port: http\n          - path: /notifications/hub\n            pathType: Prefix\n            service:\n              identifier: main\n              port: websocket\n\nroute:\n  # -- Enable and configure route settings for the chart under this key.\n  main:\n    parentRefs:\n      - name: gateway\n        namespace: gateway-namespace\n        sectionName: gateway-section\n    hostnames:\n      - chart-example.local\n    rules:\n      - matches:\n          - path:\n              type: PathPrefix\n              value: /\n        backendRefs:\n          - kind: Service\n            port: 80\n            name: main\n            namespace: default\n            weight: 1\n      - matches:\n          - path:\n              type: PathPrefix\n              value: /notifications/hub/negotiate\n        backendRefs:\n          - kind: Service\n            port: 80\n            name: main\n            namespace: default\n            weight: 1\n      - matches:\n          - path:\n              type: PathPrefix\n              value: /notifications/hub\n        backendRefs:\n          - kind: Service\n            port: 3012\n            name: main\n            namespace: default\n            weight: 1\n\n# -- Configure persistence settings for the chart under this key.\npersistence:\n  config:\n    type: persistentVolumeClaim\n    accessMode: ReadWriteOnce\n    size: 1Gi\n    globalMounts:\n      - path: /config\n</code></pre>"},{"location":"app-template/#upgrade-instructions","title":"Upgrade instructions","text":"<p>Upgrade instructions for major versions can be found here.</p>"},{"location":"app-template/#source-code","title":"Source code","text":"<p>The source code for the app template chart can be found here.</p>"},{"location":"app-template/upgrade-instructions/","title":"Upgrade instructions","text":""},{"location":"app-template/upgrade-instructions/#from-3xx-to-40x","title":"From 3.x.x to 4.0.x","text":"<p>Migrating from v3.x to v4.x introduces a number of breaking changes. Additionally, the minimum required Kubernetes version has been increased to version 1.28.x.</p>"},{"location":"app-template/upgrade-instructions/#resource-names","title":"Resource names","text":"<p>A new and consistent resource naming scheme has been implemented throughout the chart.</p> <p>Info</p> <p>See here for more information on how the new naming scheme works.</p> <p>This change may lead to generated resources getting new names, causing resources with the old naming scheme to be removed.</p> <p>Warning</p> <p>IMPORTANT As with any major software version upgrade, please verify that you have a working backup of your data.</p>"},{"location":"app-template/upgrade-instructions/#serviceaccounts","title":"serviceAccounts","text":""},{"location":"app-template/upgrade-instructions/#tokens","title":"Tokens","text":"<p>When creating a serviceAccount in v3, this would always also create a Secret containing a static long-lived Service Account token. Nowadays it is preferable to use short-lived tokens and have Kubernetes manage them automatically.</p> <p>If a static long-lived token is still required for a serviceAccount, this can be configured by setting the <code>staticToken</code> key of the serviceAccount to <code>true</code>.</p>"},{"location":"app-template/upgrade-instructions/#creation","title":"Creation","text":"<p>The syntax for creating service accounts has changed. Instead of configuring a <code>default</code> serviceAccount and optional <code>extraServiceAccounts</code> the syntax has been brought in line with other resources:</p> <pre><code>serviceAccount:\n  myServiceAccount: {}\n  mySecondServiceAccount:\n    staticToken: true\n  myThirdServiceAccount:\n    enabled: false\n\ncontrollers:\n  main:\n    serviceAccount:\n      identifier: myServiceAccount\n</code></pre>"},{"location":"app-template/upgrade-instructions/#controller-labels","title":"Controller labels","text":"<p>The hardcoded <code>app.kubernetes.io/component</code> label that is used to target specific controllers has been renamed to <code>app.kubernetes.io/controller</code>.</p> <p>Info</p> <p>Because controller labels are considered immutable by Kubernetes existing Deployments / StatefulSets / etc will have to be recreated.</p>"},{"location":"app-template/upgrade-instructions/#from-2xx-to-30x","title":"From 2.x.x to 3.0.x","text":"<p>The main changes from v2.x to v3.x are the removal of the default <code>main</code> objects and the introduction of JSON schema validation.</p> <p>Given the following real-life example values.yaml for app-template v2:</p> Expand <pre><code>---\ndefaultPodOptions:\n  securityContext:\n    runAsUser: 568\n    runAsGroup: 568\n    fsGroup: 568\n    fsGroupChangePolicy: \"OnRootMismatch\"\n    supplementalGroups:\n      - 65539\n\ncontrollers:\n  main:\n    containers:\n      main:\n        image:\n          repository: ghcr.io/onedr0p/sabnzbd\n          tag: latest\n          pullPolicy: IfNotPresent\n\nservice:\n  main:\n    ports:\n      http:\n        port: 8080\n\ningress:\n  media:\n    enabled: true\n    className: \"ingress-nginx\"\n    hosts:\n      - host: sabnzbd.bjw-s.dev\n        paths:\n          - path: /\n            service:\n              name: main\n              port: http\n\npersistence:\n  media:\n    existingClaim: nas-media\n    globalMounts:\n      - path: /data/nas-media\n</code></pre> <p>The values for app-template v3.x would become this:</p> <pre><code>---\ndefaultPodOptions:\n  enableServiceLinks: true\n  securityContext:\n    runAsUser: 568\n    runAsGroup: 568\n    fsGroup: 568\n    fsGroupChangePolicy: \"OnRootMismatch\"\n    supplementalGroups:\n      - 65539\n\ncontrollers:\n  sabnzbd: # this can now be any name you wish\n    containers:\n      app: # this can now be any name you wish\n        image:\n          repository: ghcr.io/onedr0p/sabnzbd\n          tag: latest\n          pullPolicy: IfNotPresent\n\n        probes:\n          liveness:\n            enabled: true\n          readiness:\n            enabled: true\n          startup:\n            enabled: true\n            spec:\n              failureThreshold: 30\n              periodSeconds: 5\n\nservice:\n  app: # this can now be any name you wish\n    controller: sabnzbd\n    ports:\n      http:\n        port: 8080\n\ningress:\n  media: # this can now be any name you wish\n    className: \"ingress-nginx\"\n    hosts:\n      - host: sabnzbd.bjw-s.dev\n        paths:\n          - path: /\n            service:\n              identifier: app\n              port: http\n\npersistence:\n  media:\n    existingClaim: nas-media\n    globalMounts:\n      - path: /data/nas-media\n</code></pre>"},{"location":"app-template/upgrade-instructions/#diff-view","title":"\ud83d\udea7 Diff view","text":"Expand <pre><code>--- old\n+++ new\n@@ -1,42 +1,55 @@\n---\n defaultPodOptions:\n+  enableServiceLinks: true\n   securityContext:\n     runAsUser: 568\n     runAsGroup: 568\n     fsGroup: 568\n     fsGroupChangePolicy: \"OnRootMismatch\"\n     supplementalGroups:\n       - 65539\n\n controllers:\n-  main:\n+  sabnzbd: # this can now be any name you wish\n     containers:\n-      main:\n+      app: # this can now be any name you wish\n         image:\n           repository: ghcr.io/onedr0p/sabnzbd\n           tag: latest\n           pullPolicy: IfNotPresent\n\n+        probes:\n+          liveness:\n+            enabled: true\n+          readiness:\n+            enabled: true\n+          startup:\n+            enabled: true\n+            spec:\n+              failureThreshold: 30\n+              periodSeconds: 5\n+\n service:\n-  main:\n+  app: # this can now be any name you wish\n+    controller: sabnzbd\n     ports:\n       http:\n         port: 8080\n\n ingress:\n-  media:\n-    enabled: true\n+  media: # this can now be any name you wish\n     className: \"ingress-nginx\"\n     hosts:\n       - host: sabnzbd.bjw-s.dev\n         paths:\n           - path: /\n             service:\n-              name: main\n+              identifier: app\n               port: http\n\n persistence:\n   media:\n     existingClaim: nas-media\n     globalMounts:\n       - path: /data/nas-media\n</code></pre>"},{"location":"app-template/upgrade-instructions/#changes-in-this-example","title":"Changes in this example","text":"<p>This is not meant as an exhaustive list of changes, but rather a \"most common\" example.</p> <ul> <li>The <code>main</code> object for controllers, containers, services and ingress has been removed from <code>values.yaml</code> and will therefore no longer provide any (both expected and unexpected) default values.</li> <li>The <code>config</code> object for persistence has been removed from <code>values.yaml</code> and will therefore no longer provide any (both expected and unexpected) default values.</li> <li><code>enableServiceLinks</code> has been disabled by default. In order to explicitly enable serviceLinks, set the value to <code>true</code>.</li> <li><code>ingress.*.hosts.*.paths.*.service</code> Service references now require either <code>name</code> or <code>identifier</code> to be set.</li> <li>Persistence items of type <code>configMap</code> and <code>secret</code> object references now allow either <code>name</code> or <code>identifier</code> to be set.</li> </ul>"},{"location":"app-template/upgrade-instructions/#from-1xx-to-20x","title":"From 1.x.x to 2.0.x","text":"<p>Warning</p> <p>IMPORTANT Because a new label has been introduced in the controller labelSelector (which is an immutable field), Deployments cannot be upgraded in place! More details</p> <p>Info</p> <p>Some items (Ingress, ports, persistence items, etc) now default to being enabled by default. However, this is not always the case for some of the <code>items due to overrides in the default</code>values.yaml`. More background</p> <p>Given the following real-life example values.yaml for app-template v1:</p> Expand <pre><code>image:\n  repository: ghcr.io/onedr0p/sabnzbd\n  tag: latest\n  pullPolicy: IfNotPresent\n\npodSecurityContext:\n  runAsUser: 568\n  runAsGroup: 568\n  fsGroup: 568\n  fsGroupChangePolicy: \"OnRootMismatch\"\n  supplementalGroups:\n    - 65539\n\nservice:\n  main:\n    ports:\n      http:\n        port: 8080\n\ningress:\n  media:\n    enabled: true\n    ingressClassName: \"ingress-nginx\"\n    hosts:\n      - host: sabnzbd.bjw-s.dev\n        paths:\n          - path: /\n\npersistence:\n  media:\n    enabled: true\n    existingClaim: nas-media\n    globalMounts:\n      - path: /data/nas-media\n\nprobes:\n  liveness:\n    enabled: false\n  readiness:\n    enabled: false\n  startup:\n    enabled: false\n</code></pre> <p>The values for app-template v2.x would become this:</p> <pre><code>defaultPodOptions:\n  securityContext:\n    runAsUser: 568\n    runAsGroup: 568\n    fsGroup: 568\n    fsGroupChangePolicy: \"OnRootMismatch\"\n    supplementalGroups:\n      - 65539\n\ncontrollers:\n  main:\n    containers:\n      main:\n        image:\n          repository: ghcr.io/onedr0p/sabnzbd\n          tag: latest\n          pullPolicy: IfNotPresent\n\n        probes:\n          liveness:\n            enabled: false\n          readiness:\n            enabled: false\n          startup:\n            enabled: false\n\nservice:\n  main:\n    ports:\n      http:\n        port: 8080\n\ningress:\n  media:\n    enabled: true\n    className: \"ingress-nginx\"\n    hosts:\n      - host: sabnzbd.bjw-s.dev\n        paths:\n          - path: /\n            service:\n              name: main\n              port: http\n\npersistence:\n  media:\n    existingClaim: nas-media\n    globalMounts:\n      - path: /data/nas-media\n</code></pre>"},{"location":"app-template/upgrade-instructions/#changes-in-this-example_1","title":"Changes in this example","text":"<p>This is not meant as an exhaustive list of changes, but rather a \"most common\" example.</p> <ul> <li><code>podSecurityContext</code> has been moved to <code>defaultPodOptions.securityContext</code>. It is also possible to configure this on a controller-specific basis by moving it to <code>controllers.main.pod.securityContext</code> instead.</li> <li><code>image</code> has been moved to <code>controllers.main.containers.main.image</code> so that multiple containers can be configured.</li> <li><code>ingress.media.ingressClassName</code> has been renamed to <code>ingress.main.className</code>.</li> <li><code>ingress.media.enabled</code> can be removed, since items are considered enabled by default (they can still be disabled by adding <code>enabled: false</code>).</li> <li><code>ingress.media.hosts.*.paths.*.service</code> is now required since there is no more concept of a default \"primary\" service.</li> <li><code>persistence.media.mountPath</code> has been moved to <code>persistence.media.globalMounts.*.path</code> to allow multiple mountPaths for the same persistence item.</li> <li><code>persistence.media.enabled</code> can be removed, since items are considered enabled by default (they can still be disabled by adding <code>enabled: false</code>).</li> <li><code>probes</code> has been moved to <code>controllers.main.containers.main.probes</code> so that multiple containers can be configured.</li> </ul>"},{"location":"app-template/examples/","title":"Examples","text":"<p>Here you can find some examples for more complex app-template configurations.</p>"},{"location":"app-template/examples/netbox/","title":"Netbox with pgbouncer sidecar","text":"<p>How to deploy netbox with a pgbouncer sidecar.</p> <pre><code>---\n# yaml-language-server: $schema=https://raw.githubusercontent.com/TilloTech/tillo-platform-helm-library/app-template-4.5.0/charts/other/app-template/values.schema.json\n\nglobal:\n  # Always appends identifier to resource name\n  alwaysAppendIdentifierToResourceName: true\n\n# Configure options applied to all pods\ndefaultPodOptions:\n  automountServiceAccountToken: true\n  securityContext:\n    allowPrivilegeEscalation: false\n    capabilities:\n      drop:\n        - ALL\n    privileged: false\n    readOnlyRootFilesystem: true\n    runAsNonRoot: true\n    runAsUser: 1000\n    seccompProfile:\n      type: RuntimeDefault\n\n\n# Configures netbox service account, that can be attached to controllers via the identifier\nserviceAccount:\n   netbox:\n     enabled: true\n     annotations:\n       eks.amazonaws.com/role-arn: arn:aws:iam::xxxxxxxxxxxx:role/xxxxxxxxxxxxxxxxxxxxxxxxxxxx\n\ncontrollers:\n  # Configure the main controller\n  netbox:\n    type: deployment\n    replicas: 3\n    strategy: RollingUpdate\n    rollingUpdate:\n      unavailable: 60%\n      surge: 2\n    revisionHistoryLimit: 3\n    serviceAccount:\n      identifier: netbox\n    podDisruptionBudget:\n      maxUnavailable: 1\n    annotations:\n      configmap.reloader.tillo.io/auto: \"true\"\n    pod:\n      terminationGracePeriodSeconds: 60\n    containers:\n      # Configure the netbox application container\n      netbox:\n        dependsOn: pgbouncer\n        image:\n          # -- image repository\n          repository: netboxcommunity/netbox\n          # -- image tag\n          # this example is not automatically updated, so be sure to use the latest image\n          tag: v4.4-3.4.2\n        envFrom:\n          - config: vars\n        env:\n          POD_IP:\n            valueFrom:\n              fieldRef:\n                apiVersion: v1\n                fieldPath: status.podIP\n        ports:\n          - name: http\n            containerPort: 8080\n          - name: http-status\n            containerPort: 8081\n        probes:\n          startup:\n            enabled: true\n            type: HTTP\n            path: /status/applications/netbox/processes/running\n            port: http-status\n            spec:\n              failureThreshold: 30\n              periodSeconds: 10\n              timeoutSeconds: 5\n              initialDelaySeconds: 5\n          liveness:\n            enabled: true\n            type: HTTP\n            path: /status/applications/netbox/processes/running\n            port: http-status\n            spec:\n              initialDelaySeconds: 0\n              periodSeconds: 10\n              timeoutSeconds: 2\n              failureThreshold: 3\n          readiness:\n            enabled: true\n            type: HTTP\n            path: /login/\n            spec:\n              initialDelaySeconds: 0\n              periodSeconds: 10\n              timeoutSeconds: 5\n              failureThreshold: 4\n        lifecycle:\n          preStop:\n            exec:\n              command:\n                - /bin/sh\n                - -c\n                - |\n                  echo \"Shutting down nginx unit listener...\"\n                  curl -s -X DELETE --unix-socket /opt/unit/unit.sock \"http://localhost/config/listeners/*:8080\" || true\n                  echo \"Sleeping to allow in-flight requests to drain/complete\"\n                  sleep 10\n                  echo \"Killing unitd to trigger shutdown\"\n                  pkill unitd || true\n        resources:\n          limits:\n            memory: 2Gi\n          requests:\n            cpu: 2\n            memory: 2Gi\n\n      # Configure the pgbouncer sidecar (handles connection pooling)\n      pgbouncer:\n        image:\n          repository: edoburu/pgbouncer\n          tag: latest\n          pullPolicy: IfNotPresent\n        envFrom:\n          - config: pgbouncer-config\n        env:\n          DB_USER:\n            valueFrom:\n              dynamicSecretKeyRef:\n                optional: true\n                key: username\n                identifier:\n          DB_PASSWORD:\n            valueFrom:\n              dynamicSecretKeyRef:\n                optional: true\n                key: password\n                identifier:\n          ADMIN_USERS:\n            valueFrom:\n              dynamicSecretKeyRef:\n                optional: true\n                key: username\n                identifier:\n        ports:\n          - name: postgres\n            containerPort: 5432\n        probes:\n          liveness:\n            enabled: true\n            type: tcp\n            port: postgres\n            spec:\n              initialDelaySeconds: 5\n              periodSeconds: 30\n              timeoutSeconds: 3\n              failureThreshold: 3\n          readiness:\n            enabled: true\n            type: tcp\n            port: postgres\n            spec:\n              initialDelaySeconds: 5\n              periodSeconds: 30\n              timeoutSeconds: 3\n              failureThreshold: 3\n        resources:\n          requests:\n            cpu: 10m\n            memory: 100Mi\n        lifecycle:\n          preStop:\n            exec:\n              command: [ \"/bin/sh\", \"-c\", \"sleep 15 &amp;&amp; killall -INT pgbouncer\" ]\n        securityContext:\n          allowPrivilegeEscalation: false\n          capabilities:\n            drop:\n              - ALL\n\n      # Configures init containers that spawn before our two primary containers\n    initContainers:\n      init-dirs:\n        image:\n          repository: busybox\n          tag: 1.36.1\n          pullPolicy: IfNotPresent\n        command:\n          - /bin/sh\n          - '-c'\n          - mkdir -p /opt/unit/state /opt/unit/tmp\n          - mkdir -p /run/config/netbox\n        securityContext:\n          allowPrivilegeEscalation: false\n          capabilities:\n            drop:\n              - ALL\n          privileged: false\n          readOnlyRootFilesystem: true\n          runAsNonRoot: true\n          runAsUser: 1000\n          seccompProfile:\n            type: RuntimeDefault\n\n  worker:\n    enabled: true\n    type: deployment\n    replicas: 2\n    strategy: RollingUpdate\n    revisionHistoryLimit: 3\n    annotations:\n      configmap.reloader.tillo.io/auto: \"true\"\n    serviceAccount:\n      identifier: netbox\n    podDisruptionBudget:\n      maxUnavailable: 1\n    pod:\n      terminationGracePeriodSeconds: 90\n    containers:\n      # Configure the netbox worker container\n      worker:\n        dependsOn: pgbouncer\n        image:\n          # -- image repository\n          repository: netboxcommunity/netbox\n          # -- image tag\n          # this example is not automatically updated, so be sure to use the latest image\n          tag: v4.4-3.4.2\n        command:\n          - /opt/netbox/venv/bin/python\n          - /opt/netbox/netbox/manage.py\n          - rqworker\n        envFrom:\n          - config: vars\n        env:\n          POD_IP:\n            valueFrom:\n              fieldRef:\n                apiVersion: v1\n                fieldPath: status.podIP\n        probes:\n          liveness:\n            enabled: false\n          readiness:\n            enabled: false\n        resources:\n          limits:\n            memory: 300Mi\n          requests:\n            cpu: 10m\n            memory: 200Mi\n      pgbouncer:\n        image:\n          repository: edoburu/pgbouncer\n          tag: latest\n          pullPolicy: IfNotPresent\n        envFrom:\n          - config: pgbouncer-config\n        env:\n          DB_USER:\n            valueFrom:\n              dynamicSecretKeyRef:\n                optional: true\n                key: username\n                identifier:\n          DB_PASSWORD:\n            valueFrom:\n              dynamicSecretKeyRef:\n                optional: true\n                key: password\n                identifier:\n          ADMIN_USERS:\n            valueFrom:\n              dynamicSecretKeyRef:\n                optional: true\n                key: username\n                identifier:\n        ports:\n          - name: postgres\n            containerPort: 5432\n        probes:\n          liveness:\n            enabled: true\n            type: tcp\n            port: postgres\n            spec:\n              initialDelaySeconds: 5\n              periodSeconds: 30\n              timeoutSeconds: 3\n              failureThreshold: 3\n          readiness:\n            enabled: true\n            type: tcp\n            port: postgres\n            spec:\n              initialDelaySeconds: 5\n              periodSeconds: 30\n              timeoutSeconds: 3\n              failureThreshold: 3\n        resources:\n          requests:\n            cpu: 10m\n            memory: 100Mi\n        lifecycle:\n          preStop:\n            exec:\n              command: [ \"/bin/sh\", \"-c\", \"sleep 15 &amp;&amp; killall -INT pgbouncer\" ]\n        securityContext:\n          allowPrivilegeEscalation: false\n          capabilities:\n            drop:\n              - ALL\n\n  housekeeping:\n    enabled: true\n    type: cronjob\n    cronjob:\n      suspend: false\n      concurrencyPolicy: Forbid\n      schedule: \"0 0 * * *\"\n      startingDeadlineSeconds: 30\n      successfulJobsHistory: 3\n      failedJobsHistory: 2\n      ttlSecondsAfterFinished: 28800\n      backoffLimit: 2\n    revisionHistoryLimit: 3\n    containers:\n      housekeeping:\n        image:\n          # -- image repository\n          repository: netboxcommunity/netbox\n          # -- image tag\n          # this example is not automatically updated, so be sure to use the latest image\n          tag: v4.4-3.4.2\n          pullPolicy: Always\n        command:\n          - /opt/netbox/venv/bin/python\n          - /opt/netbox/netbox/manage.py\n          - housekeeping\n        env:\n          HOUSEKEEPING_INTERVAL: '20'\n          DB_HOST: postgres-rw.postgres.svc.cluster.local\n          CONN_MAX_AGE: 300\n          POD_IP:\n            valueFrom:\n              fieldRef:\n                apiVersion: v1\n                fieldPath: status.podIP\n        probes:\n          liveness:\n            enabled: false\n          readiness:\n            enabled: false\n\n\nservice:\n  # Configure a service for the netbox application\n  netbox:\n    controller: netbox\n    primary: true\n    type: ClusterIP\n    ports:\n      http:\n        enabled: true\n        port: 80\n        targetPort: 8080\n        protocol: HTTP\n  # Configure a metrics-service for the netbox application\n  metrics:\n    enabled: true\n    controller: netbox\n    type: ClusterIP\n    ports:\n      http-metrics:\n        enabled: true\n        port: 8080\n        targetPort: 8080\n        protocol: HTTP\n\ningress:\n  # Configure an Ingress for the main application\n  netbox:\n    className: \"alb\"\n    annotations:\n      external-dns.alpha.kubernetes.io/ttl: \"30\"\n    hosts:\n      - host: \"netbox.example.local\"\n        paths:\n          - path: /\n            pathType: Prefix\n            service:\n              identifier: netbox\n              port: http\n\npersistence:\n  # Configure an empty volume in all controllers &amp; containers\n  netbox-empty:\n    enabled: true\n    type: emptyDir\n    globalMounts:\n      - path: /run/config/netbox\n        readOnly: false\n\n  # Configures netbox.yaml configMap into all controllers &amp; containers\n  netbox:\n    enabled: true\n    type: configMap\n    name: config\n    globalMounts:\n      - path: /run/config/netbox/netbox.yaml\n        readOnly: true\n        subPath: netbox.yaml\n\n  # Configures secrets into all controllers &amp; containers as a file\n  netbox-secrets:\n    enabled: true\n    type: vaultStaticSecret\n    identifier: secrets\n    defaultMode: 420\n    globalMounts:\n      - path: /run/secrets/netbox\n        readOnly: true\n\n  # Configures database secret into all controllers &amp; containers as a file\n  database-secrets:\n    enabled: true\n    type: vaultDynamicSecret\n    identifier: database\n    defaultMode: 420\n    globalMounts:\n      - path: /run/secrets/database\n        readOnly: true\n\n  # Configures runtime files into select controllers &amp; containers, using advancedMounts to select Key from configMap &amp; destination.\n  config:\n    enabled: true\n    type: configMap\n    name: files\n    advancedMounts:\n      netbox:\n        netbox:\n          - path: /etc/netbox/config/configuration.py\n            readOnly: true\n            subPath: configuration.py\n          - path: /opt/netbox/netbox/netbox/custom_pipeline.py\n            readOnly: true\n            subPath: custom_pipeline.py\n          - path: /opt/netbox/netbox/netbox/local_settings.py\n            readOnly: true\n            subPath: local_settings.py\n          - path: /run/config/extra/auth/social-auth-pipeline.yaml\n            readOnly: true\n            subPath: social-auth-pipeline.yaml\n      worker:\n        worker:\n          - path: /etc/netbox/config/configuration.py\n            readOnly: true\n            subPath: configuration.py\n          - path: /opt/netbox/netbox/netbox/custom_pipeline.py\n            readOnly: true\n            subPath: custom_pipeline.py\n          - path: /opt/netbox/netbox/netbox/local_settings.py\n            readOnly: true\n            subPath: local_settings.py\n          - path: /run/config/extra/auth/social-auth-pipeline.yaml\n            readOnly: true\n            subPath: social-auth-pipeline.yaml\n      housekeeping:\n        housekeeping:\n          - path: /etc/netbox/config/configuration.py\n            readOnly: true\n            subPath: configuration.py\n          - path: /opt/netbox/netbox/netbox/custom_pipeline.py\n            readOnly: true\n            subPath: custom_pipeline.py\n          - path: /opt/netbox/netbox/netbox/local_settings.py\n            readOnly: true\n            subPath: local_settings.py\n          - path: /run/config/extra/auth/social-auth-pipeline.yaml\n            readOnly: true\n            subPath: social-auth-pipeline.yaml\n\n  # Configures nginx-unit config in our primary controller &amp; container only\n  nginx-unit:\n    enabled: true\n    type: configMap\n    name: nginx-unit\n    advancedMounts:\n      netbox:\n        netbox:\n          - path: /run/config/netbox/nginx-unit.json\n            readOnly: true\n            subPath: nginx-unit.json\n\n  # Configures tmp emptyDir in all Controllers &amp; containers backed by Memory\n  netbox-tmp:\n    enabled: true\n    type: emptyDir\n    medium: Memory\n    globalMounts:\n      - path: /tmp\n        readOnly: false\n\n  # Configures emptyDirt at select controllers &amp; containers backed by Memory\n  optunit:\n    enabled: true\n    type: emptyDir\n    medium: Memory\n    advancedMounts:\n      netbox:\n        init-dirs:\n          - path: /opt/unit\n            readOnly: false\n        netbox:\n          - path: /opt/unit\n            readOnly: false\n        worker:\n          worker:\n            - path: /opt/unit\n              readOnly: false\n\n\nvaultDynamicSecrets:\n  # Configures a vaultDynamicSecrets CRD that points to a dynamic credential within Vault\n  database:\n    enabled: true\n    mount: internal-postgres\n    path: creds/netbox-application\n    refreshAfter: 30s\n    rolloutRestartControllers:\n      - netbox\n      - worker\n\nvaultStaticSecrets:\n  # Configures a vaultStaticSecrets CRD that points to a KV path within Vault\n  secrets:\n    enabled: true\n    mount: kv\n    path: applications/netbox/secrets\n    type: kv-v2\n    refreshAfter: 5m\n    rolloutRestartControllers:\n      - netbox\n      - worker\n\nonfigMaps:\n  vars:\n    enabled: true\n    data:\n      DB_HOST: 127.0.0.1\n      DB_WAIT_DEBUG: '0'\n      CONN_MAX_AGE: '60'\n      DISABLE_SERVER_SIDE_CURSORS: 'True'\n      UNIT_CONFIG: /run/config/netbox/nginx-unit.json\n      SUPERUSER_NAME: admin\n      SUPERUSER_EMAIL: admin@example.com\n      SKIP_STARTUP_SCRIPTS: 'true'\n      SKIP_SUPERUSER: 'true'\n      NETBOX_DELETE_LEGACY_DATA: '1'\n\n  pgbouncer:\n    enabled: true\n    data:\n      AUTH_TYPE: scram-sha-256\n      DB_HOST: postgres-rw.postgres.svc.cluster.local\n      DB_NAME: netbox\n\n      MAX_CLIENT_CONN: '300'\n      DEFAULT_POOL_SIZE: '20'\n      RESERVE_POOL_SIZE: '5'\n      RESERVE_POOL_TIMEOUT: '5.0'\n      POOL_MODE: transaction\n      APPLICATION_NAME_ADD_HOST: '1'\n\n      SERVER_CHECK_DELAY: '30'\n      SERVER_LIFETIME: '1800'\n      SERVER_IDLE_TIMEOUT: '300'\n      CLIENT_IDLE_TIMEOUT: '600'\n      SERVER_RESET_QUERY: DISCARD ALL\n\n      LOG_CONNECTIONS: '0'\n      LOG_DISCONNECTIONS: '0'\n      LOG_POOLER_ERRORS: '1'\n      LOG_STATS: '1'\n      STATS_PERIOD: '60'\n      VERBOSE: '0'\n\n  config:\n    enabled: true\n    data:\n      netbox.yaml: |-\n        ALLOWED_HOSTS: [\"*\"]\n        ALLOWED_HOSTS_INCLUDES_POD_ID: true\n        DATABASES:\n          default:\n            NAME: \"netbox\"\n            PORT: 5432\n            OPTIONS:\n              sslmode: \"prefer\"\n              target_session_attrs: \"read-write\"\n            DISABLE_SERVER_SIDE_CURSORS: false\n\n        LOGGING: {\n          'version': 1,\n          'disable_existing_loggers': False,\n          'handlers': {\n            'console': {\n              'level': 'INFO',\n              'class': 'logging.StreamHandler',\n              'stream': 'ext://sys.stdout',\n            },\n          },\n          'root': {\n            'handlers': ['console'],\n            'level': 'ERROR',  # Only critical system-level issues bubble up here\n          },\n          'loggers': {\n            'django': {\n              'handlers': ['console'],\n              'level': 'ERROR',  # Capture everything Django emits, including queries, etc.\n              'propagate': False,\n            },\n            'django.request': {\n              'handlers': ['console'],\n              'level': 'WARNING',  # Only warnings/errors from HTTP request/response\n              'propagate': False,\n            },\n            'netbox': {\n              'handlers': ['console'],\n              'level': 'DEBUG',  # Capture debug-level logs for NetBox internals\n              'propagate': False,\n            },\n            'rq.worker': {\n              'handlers': ['console'],\n              'level': 'ERROR',  # Job queue logging \u2014 useful for debugging background tasks\n              'propagate': False,\n            },\n          },\n        }\n\n\n  nginx-unit:\n    enabled: true\n    data:\n      nginx-unit.json: |-\n        {\n          \"listeners\": {\n            \"*:8080\": {\n              \"pass\": \"routes/main\",\n              \"forwarded\": {\n                \"client_ip\": \"X-Forwarded-For\",\n                \"protocol\": \"X-Forwarded-Proto\",\n                \"source\": [\"172.16.0.0/12\"]\n              }\n            },\n            \"*:8081\": {\n              \"pass\": \"routes/status\",\n              \"forwarded\": {\n                \"client_ip\": \"X-Forwarded-For\",\n                \"protocol\": \"X-Forwarded-Proto\",\n                \"source\": [\"172.16.0.0/12\"]\n              }\n            }\n          },\n          \"routes\": {\n            \"main\": [\n              {\n                \"match\": {\n                  \"uri\": \"/static/*\"\n                },\n                \"action\": {\n                  \"share\": \"/opt/netbox/netbox${uri}\"\n                }\n              },\n              {\n                \"action\": {\n                  \"pass\": \"applications/netbox\"\n                }\n              }\n            ],\n            \"status\": [\n              {\n                \"match\": {\n                  \"uri\": \"/status/*\"\n                },\n                \"action\": {\n                  \"proxy\": \"http://unix:/opt/unit/unit.sock\"\n                }\n              }\n            ]\n          },\n          \"applications\": {\n            \"netbox\": {\n              \"type\": \"python 3\",\n              \"path\": \"/opt/netbox/netbox/\",\n              \"module\": \"netbox.wsgi\",\n              \"home\": \"/opt/netbox/venv\",\n              \"processes\": {\n                \"max\": 4,\n                \"spare\": 2,\n                \"idle_timeout\": 360\n              }\n            }\n          },\n          \"access_log\": \"/dev/stdout\"\n        }\n\n\n  files:\n    enabled: true\n    data:\n      configuration.py: |-\n        EXAMPLE FILE\n      custom_pipeline.py: |-\n        EXAMPLE FILE\n      local_settings.py: |-\n        EXAMPLE FILE\n      social-auth-pipeline.yaml: |-\n        EXAMPLE FILE\n</code></pre>"},{"location":"app-template/howto/","title":"How to...","text":"<p>Here you can find information on how to accomplish specific scenario's.</p>"},{"location":"app-template/howto/environment-variables/","title":"Environment Variables","text":""},{"location":"app-template/howto/environment-variables/#set-environment-variables-directly","title":"Set environment variables directly","text":"<p>Setting environment variables for a container can be done in several ways. The simplest is to define them directly in the container settings using the <code>env</code> field. This can be done with a list of key/value items or a dictionary of items:</p> <p>List of key / values items:</p> <pre><code>containers:\n  main:\n    env:\n      - name: ENV_VAR_NAME\n        value: \"value\"\n      - name: ANOTHER_ENV_VAR\n        value: \"another value\"\n</code></pre> <p>Dictionary style:</p> <pre><code>containers:\n  main:\n    env:\n      ENV_VAR_NAME: \"value\"\n      ANOTHER_ENV_VAR: \"another value\"\n</code></pre>"},{"location":"app-template/howto/environment-variables/#environment-variables-ordering","title":"Environment variables ordering","text":"<p>Sometimes (for example, when relying on dependent environment variables) the order of the environment variables is important. In those cases it is possible to explicitly define environment variable dependency through the <code>dependsOn</code> field:</p> <pre><code>containers:\n  main:\n    env:\n      STATIC_ENV: 1\n      DYNAMIC_ENV:\n        valueFrom:\n          fieldRef:\n            fieldPath: spec.nodeName\n        dependsOn: STATIC_ENV\n      ORDERED_ENV:\n        value: true\n        dependsOn: STATIC_ENV\n      DEPENDENT_ENV:\n        value: moo_two\n        dependsOn:\n          - DYNAMIC_ENV\n          - ORDERED_ENV\n</code></pre>"},{"location":"app-template/howto/environment-variables/#configmaps","title":"ConfigMaps","text":"<p>You can also create a ConfigMap for shared environment variables:</p> <p>ConfigMaps can be referenced with <code>envFrom</code> &amp; <code>env</code>. It should be noted that <code>env</code> does not support <code>configMapKeyRef</code> lookups via the objects <code>identifier</code> key.</p> <pre><code>configMaps:\n  app-config:\n    data:\n      ENV_VAR_NAME: \"value\"\n      ANOTHER_ENV_VAR: \"another value\"\n\ncontrollers:\n  main:\n    containers:\n      main:\n        envFrom:\n          - configMap: app-config\n          - configMapRef:\n              # Reference an app-template ConfigMap\n              identifier: app-config\n              # Reference a preexisting ConfigMap\n              # name: preexisting-configmap-name\n        env:\n          ANOTHER_ENV_VAR:\n            valueFrom:\n              configMapKeyRef:\n                name: '{{ .Release.Name }}-app-config'\n                key: ANOTHER_ENV_VAR\n</code></pre>"},{"location":"app-template/howto/environment-variables/#secrets","title":"Secrets","text":"<p>Secrets can be referenced with <code>envFrom</code> &amp; <code>env</code>. It should be noted that <code>env</code> does not support <code>secretKeyRef</code> lookups via the objects <code>identifier</code> key.</p> <pre><code>secrets:\n  app-secrets:\n    stringData:\n      SECRET_KEY: \"s3cr3t\"\ncontrollers:\n  main:\n    containers:\n      main:\n        envFrom:\n          - secret: app-secrets\n          - secretRef:\n              identifier: app-secrets\n        env:\n          SECRET_KEY:\n            valueFrom:\n              secretKeyRef:\n                name: '{{ .Release.Name }}-app-secrets'\n                key: SECRET_KEY\n</code></pre>"},{"location":"app-template/howto/environment-variables/#vault-static-secrets-crd","title":"Vault Static Secrets (CRD)","text":"<p>Vault Static Secrets are managed in the same way but do support <code>identifier</code> lookups on both <code>envFrom</code> &amp; <code>env</code></p> <pre><code>vaultStaticSecrets:\n  secrets:\n    enabled: true\n    mount: kv\n    type: kv-v2\n    refreshAfter: 5m\n    hmacSecretData: true\n    path: main/secrets\n    rolloutRestartControllers:\n      - main\ncontrollers:\n  main:\n    containers:\n      main:\n        envFrom:\n          - staticSecret: secrets\n          - staticSecretRef:\n              identifier: secrets\n        env:\n          SECRET_KEY:\n            valueFrom:\n              staticSecretKeyRef:\n                identifier: secrets\n                key: SECRET_KEY\n</code></pre>"},{"location":"app-template/howto/environment-variables/#vault-dynamic-secrets-crd","title":"Vault Dynamic Secrets (CRD)","text":"<p>Vault Dynamic Secrets are managed in the same way but do support <code>identifier</code> lookups on both <code>envFrom</code> &amp; <code>env</code></p> <pre><code>vaultDynamicSecrets:\n  database:\n    enabled: true\n    refreshAfter: 30s\n    mount: database\n    path: creds/database\n    rolloutRestartControllers:\n      - main\ncontrollers:\n  main:\n    containers:\n      main:\n        envFrom:\n          - dynamicSecret: database\n          - dynamicSecretRef:\n              identifier: database\n        env:\n          DB_USER:\n            valueFrom:\n              dynamicSecretKeyRef:\n                identifier: database\n                key: username\n          DB_PASSWORD:\n            valueFrom:\n              dynamicSecretKeyRef:\n                identifier: database\n                key: password\n</code></pre>"},{"location":"app-template/howto/helm-templates/","title":"Helm templates","text":"<p>Some fields in the common library <code>values.yaml</code> allow the use of Helm templates for their values. This is often indicated by a remark similar to <code>Helm template enabled</code> in the field description.</p> <p>This feature allows you to set the value of that key to the output of the given Helm template.</p>"},{"location":"app-template/howto/helm-templates/#example","title":"Example","text":"<p>Given the following <code>values.yaml</code></p> <pre><code>containers:\n  subcleaner:\n    name: subcleaner\n\n    image:\n      repository: k8s.gcr.io/git-sync/git-sync\n      tag: {{.Chart.AppVersion}}\n\n    args:\n      - --repo=https://github.com/KBlixt/subcleaner.git\n      - --branch=master\n      - --depth=1\n      - --root=/add-ons/subcleaner\n</code></pre> <p>This would render as follows:</p> <pre><code>containers:\n  subcleaner:\n    name: subcleaner\n\n    image:\n      repository: k8s.gcr.io/git-sync/git-sync\n      tag: v3.6.2\n\n    args:\n      - --repo=https://github.com/KBlixt/subcleaner.git\n      - --branch=master\n      - --depth=1\n      - --root=/add-ons/subcleaner\n</code></pre>"},{"location":"app-template/howto/multiple-services/","title":"Multiple Services","text":""},{"location":"app-template/howto/multiple-services/#with-a-single-controller","title":"With a single controller","text":"<p>It is possible to have multiple Service objects that point to a single controller.</p>"},{"location":"app-template/howto/multiple-services/#example","title":"Example","text":"<pre><code>controllers:\n  main:\n    containers:\n      main:\n        image:\n          repository: ghcr.io/mendhak/http-https-echo\n          tag: 31\n          pullPolicy: IfNotPresent\n\nservice:\n  main:\n    controller: main # (1)!\n    ports:\n      http:\n        port: 8080\n  second:\n    controller: main # (1)!\n    ports:\n      http:\n        port: 8081\n</code></pre> <ol> <li>Point to the controller with the \"main\" identifier</li> </ol>"},{"location":"app-template/howto/multiple-services/#with-multiple-controllers","title":"With multiple controllers","text":"<p>It is also possible have multiple Service objects that point to different controllers.</p>"},{"location":"app-template/howto/multiple-services/#example_1","title":"Example","text":"<pre><code>controllers:\n  main:\n    containers:\n      main:\n        image:\n          repository: ghcr.io/mendhak/http-https-echo\n          tag: 31\n          pullPolicy: IfNotPresent\n  second:\n    containers:\n      main:\n        image:\n          repository: ghcr.io/mendhak/http-https-echo\n          tag: 31\n          pullPolicy: IfNotPresent\n\nservice:\n  main:\n    controller: main # (1)!\n    ports:\n      http:\n        port: 8080\n  second:\n    controller: main # (1)!\n    ports:\n      http:\n        port: 8081\n  third:\n    controller: second # (2)!\n    ports:\n      http:\n        port: 8081\n</code></pre> <ol> <li>Point to the controller with the \"main\" identifier</li> <li>Point to the controller with the \"second\" identifier</li> </ol>"},{"location":"app-template/howto/multiple-subpath/","title":"Multiple subPaths for 1 volume","text":"<p>It is possible to mount multiple subPaths from the same volume to a container. This can be achieved by specifying <code>subPath</code> with a list instead of a string.</p>"},{"location":"app-template/howto/multiple-subpath/#example","title":"Example","text":"<pre><code>persistence:\n  config:\n    type: configMap\n    name: my-configMap\n    advancedMounts:\n      main: # (1)!\n        main: # (2)!\n          - path: /data/config.yaml\n            readOnly: false\n            subPath: config.yaml\n          - path: /data/secondConfigFile.yaml\n            readOnly: false\n            subPath: secondConfigFile.yaml\n        second-container: # (3)!\n          - path: /appdata/config\n            readOnly: true\n      second-controller: # (4)!\n        main: # (5)!\n          - path: /data/config.yaml\n            readOnly: false\n            subPath: config.yaml\n</code></pre> <ol> <li>the controller with the \"main\" identifier</li> <li>the container with the \"main\" identifier</li> <li>the container with the \"second-container\" identifier</li> <li>the controller with the \"second-controller\" identifier</li> <li>the container with the \"main\" identifier</li> </ol>"},{"location":"common-library/","title":"Common Library","text":"<p>Note</p> <p>The Common library chart is not meant to be installed directly, application charts use the Common library as a dependency. See the app template for an example how to deploy it.</p>"},{"location":"common-library/#background","title":"Background","text":"<p>In Helm 3, their team introduced the concept of a Library chart.</p> <p>A library chart is a type of Helm chart that defines chart primitives or definitions which can be shared by Helm templates in other charts. This allows users to share snippets of code that can be re-used across charts, avoiding repetition and keeping charts DRY.</p> <p>The common library was created because I saw many charts requiring only a few select configuration options in their Helm charts.</p> <p>Note</p> <p>Take one of the many applications like <code>sonarr</code> or <code>nzbget</code>. Each of these charts only require setting <code>service</code>, <code>port</code>, <code>persistence</code>, <code>ingress</code> and <code>image</code> since state and app configuration is handled by the application itself.</p> <p>In order to stay somewhat DRY (Don't Repeat Yourself) and keeping with Helm 3 usage for a Library chart, I saw this pattern and decided it was worth it to create a library. This means each one of these app charts has a dependency on what I call the <code>common</code> library.</p>"},{"location":"common-library/#source-code","title":"Source code","text":"<p>The source code for the common library chart can be found here.</p>"},{"location":"common-library/howto/","title":"How to...","text":"<p>Here you can find information on how to accomplish specific scenario's.</p>"},{"location":"common-library/howto/default-container-options/","title":"Setting default container options","text":"<p>It is possible to configure default container options under the <code>controllers.*.defaultContainerOptions</code> key. These options will be applied to all containers within the controller.</p> <p>The following fields can be configured on this level:</p> <ul> <li><code>args</code></li> <li><code>command</code></li> <li><code>env</code></li> <li><code>envFrom</code></li> <li><code>image</code></li> <li><code>resources</code></li> <li><code>securityContext</code></li> </ul>"},{"location":"common-library/howto/default-container-options/#only-applying-to-regular-containers","title":"Only applying to regular containers","text":"<p>By default the <code>defaultContainerOptions</code> will be applied to both <code>initContainers</code> and regular <code>containers</code>. If you wish to only apply the default options to regular containers, set <code>controllers.*.applyDefaultContainerOptionsToInitContainers</code> to <code>false</code>.</p>"},{"location":"common-library/howto/default-container-options/#default-value-strategies","title":"Default value strategies","text":""},{"location":"common-library/howto/default-container-options/#overwrite","title":"Overwrite","text":"<p>The default strategy for configuring default container options is <code>overwrite</code>. This means that if a container has an entry for a default container option it will be overwritten entirely by the container-specific configuration.</p> <p>This behavior can be set explicitly by setting <code>controllers.*.defaultContainerOptionsStrategy</code> to <code>overwrite</code>.</p> <p>An (abbreviated) example of the <code>overwrite</code> strategy:</p> <pre><code>controllers:\n  main:\n    defaultContainerOptions:\n      resources:\n        requests:\n          memory: 1Gi\n          cpu: 150m\n\n    containers:\n      main:\n        ...\n        resources:\n          requests:\n            cpu: 100m\n</code></pre> <p>The expected <code>resources</code> field on the <code>main</code> container is expected to look like this:</p> <pre><code>resources:\n  requests:\n    cpu: 100m\n</code></pre>"},{"location":"common-library/howto/default-container-options/#merge","title":"Merge","text":"<p>An alternative strategy for configuring default container options is <code>merge</code>. This means that if a container has an entry for a default container option it will be merged with the container-specific configuration.</p> <p>This behavior can be set explicitly by setting <code>defaultContainerOptionsStrategy</code> to <code>merge</code>.</p> <p>An (abbreviated) example of the <code>merge</code> strategy:</p> <pre><code>controllers:\n  main:\n    defaultContainerOptionsStrategy: merge\n    defaultContainerOptions:\n      resources:\n        requests:\n          memory: 1Gi\n          cpu: 150m\n\n    containers:\n      main:\n        ...\n        resources:\n          requests:\n            cpu: 100m\n</code></pre> <p>The expected <code>resources</code> field on the <code>main</code> container is expected to look like this:</p> <pre><code>resources:\n  requests:\n    memory: 1Gi\n    cpu: 100m\n</code></pre>"},{"location":"common-library/howto/default-pod-options/","title":"Setting default Pod options","text":"<p>It is possible to configure default Pod options under the <code>defaultPodOptions</code> key. These options will be applied to all Pods specified in the chart values.</p> <p>To see which fields can be configured, please take a look at the Chart values schema specific to your Common library version. The latest version can be found here: https://github.com/TilloTech/tillo-platform-helm-library/blob/main/charts/library/common/schemas/pod.json</p>"},{"location":"common-library/howto/default-pod-options/#default-value-strategies","title":"Default value strategies","text":""},{"location":"common-library/howto/default-pod-options/#overwrite","title":"Overwrite","text":"<p>The default strategy for configuring default Pod options is <code>overwrite</code>. This means that if a controller has an entry for a default Pod option it will be overwritten entirely by the Pod-specific configuration.</p> <p>This behavior can be set explicitly by setting <code>defaultPodOptionsStrategy</code> to <code>overwrite</code>.</p> <p>An (abbreviated) example of the <code>overwrite</code> strategy:</p> <pre><code>defaultPodOptions:\n  resources:\n    requests:\n      memory: 1Gi\n      cpu: 150m\n\ncontrollers:\n  main:\n    pod:\n      resources:\n        requests:\n          cpu: 100m\n\n    containers:\n      main:\n        ...\n</code></pre> <p>The expected <code>resources</code> field on the <code>main</code> Deployment is expected to look like this:</p> <pre><code>resources:\n  requests:\n    cpu: 100m\n</code></pre>"},{"location":"common-library/howto/default-pod-options/#merge","title":"Merge","text":"<p>An alternative strategy for configuring default Pod options is <code>merge</code>. This means that if a Pod has an entry for a default Pod option it will be merged with the Pod-specific configuration.</p> <p>This behavior can be set explicitly by setting <code>defaultPodOptionsStrategy</code> to <code>merge</code>.</p> <p>An (abbreviated) example of the <code>merge</code> strategy:</p> <pre><code>defaultPodOptionsStrategy: merge\ndefaultPodOptions:\n  resources:\n    requests:\n      memory: 1Gi\n      cpu: 150m\n\ncontrollers:\n  main:\n    pod:\n      resources:\n        requests:\n          cpu: 100m\n\n    containers:\n      main:\n        ...\n</code></pre> <p>The expected <code>resources</code> field on the <code>main</code> Deployment is expected to look like this:</p> <pre><code>resources:\n  requests:\n    memory: 1Gi\n    cpu: 100m\n</code></pre>"},{"location":"common-library/resources/names/","title":"Names","text":""},{"location":"common-library/resources/names/#configuration","title":"Configuration","text":"<p>Each resource that can be created by the Common library supports the following fields to control the generated resource name, along with the resource identifier.</p> <p>All of these fields support the use of Helm templates for advanced naming requirements.</p>"},{"location":"common-library/resources/names/#forcerename","title":"forceRename","text":"<p>Override the default resource name entirely.</p> <p>Info</p> <p>The <code>forceRename</code> field is mutually exclusive with the <code>prefix</code> and <code>suffix</code> fields.</p>"},{"location":"common-library/resources/names/#prefix","title":"prefix","text":"<p>Prefix to prepend to the resource name. Will not be added if the resource name already starts with the prefix.</p>"},{"location":"common-library/resources/names/#suffix","title":"suffix","text":"<p>Suffix to append to the resource name. Will not be added if the resource name already ends with the suffix. Defaults to the resource identifier if there are multiple enabled items, otherwise it defaults to an empty value.</p>"},{"location":"common-library/resources/names/#behavior","title":"Behavior","text":"<p>By default, all resource names are based on the <code>bjw-s.common.lib.chart.names.fullname</code> template which defaults to the Helm Release name. This template can be further controlled by the <code>global.nameOverride</code> and <code>global.fullnameOverride</code> values.</p> <p>The resource identifier (key) is only appended when there are multiple resources of the same kind or if the value <code>global.alwaysAppendIdentifierToResourceName</code> is set to <code>true</code>.</p> <p>Info</p> <p>When the resource name already equals the identifier or if the identifier suffix is already present, it will not be added a second time. This is to prevent names like <code>vaultwarden-vaultwarden</code></p> <p>Assuming a Helm Release with the name <code>base_name</code>, the following table gives an overview of how the resource name is generated:</p> <code>forceRename</code> Enabled items Always append identifier <code>identifier</code> <code>prefix</code> <code>suffix</code> Expected name Notes <code>custom-name</code> <code>custom-name</code> Force rename overrides all logic <code>\"{{ .Release.Namespace }}\"</code> <code>default</code> Force rename with a template overrides all logic 1 <code>abc</code> <code>base_name</code> Base case, no additional configuration 1 <code>abc</code> <code>team</code> <code>team-base_name</code> Prefix added 1 <code>abc</code> <code>base_name</code> <code>base_name</code> Prefix equal to fullname \u2013 skipped 1 <code>abc</code> <code>svc</code> <code>base_name-svc</code> Suffix added 1 <code>abc</code> <code>base_name</code> <code>base_name</code> Suffix equal to fullname - skipped 1 <code>abc</code> <code>team</code> <code>svc</code> <code>team-base_name-svc</code> Prefix + suffix, no identifier 1 <code>true</code> <code>abc</code> <code>base_name-abc</code> identifier suffix via global flag 1 <code>true</code> <code>abc</code> <code>team</code> <code>svc</code> <code>team-base_name-abc-svc</code> Prefix + identifier + suffix via global flag 2 <code>abc</code> <code>base_name-abc</code> Identifier due to itemCount &gt; 1 2 <code>abc</code> <code>team</code> <code>svc</code> <code>team-base_name-abc-svc</code> Prefix + Identifier + Suffix 2 <code>base_name</code> <code>base_name</code> Identifier equal to fullname \u2013 skipped 2 <code>abc</code> <code>abc</code> <code>base_name-abc</code> Suffix skipped \u2013 already included by identifer"},{"location":"common-library/storage/globalOptions/","title":"Global Options","text":"<p>The following options are available for all persistence types:</p>"},{"location":"common-library/storage/globalOptions/#enabled","title":"enabled","text":"<p>Enables or disables the persistence item. Defaults to <code>true</code>.</p>"},{"location":"common-library/storage/globalOptions/#type","title":"type","text":"<p>Sets the persistence type</p> <p>Valid options are:</p> <ul> <li><code>configMap</code></li> <li><code>custom</code></li> <li><code>emptyDir</code></li> <li><code>hostPath</code></li> <li><code>nfs</code></li> <li><code>persistentVolumeClaim</code></li> <li><code>secret</code></li> </ul>"},{"location":"common-library/storage/globalOptions/#globalmounts","title":"globalMounts","text":"<p>Configure mounts to all controllers and containers. By default the persistence item will be mounted to <code>/&lt;name_of_the_peristence_item&gt;</code>.</p> <p>Example</p> <pre><code>globalMounts:\n  - path: /config\n    readOnly: false\n</code></pre>"},{"location":"common-library/storage/globalOptions/#path","title":"path","text":"<p>Where to mount the volume in the main container. Defaults to <code>/&lt;name_of_the_volume&gt;</code></p>"},{"location":"common-library/storage/globalOptions/#readonly","title":"readOnly","text":"<p>Specify if the volume should be mounted read-only</p>"},{"location":"common-library/storage/globalOptions/#subpath","title":"subPath","text":"<p>Specifies a sub-path inside the referenced volume instead of its root.</p>"},{"location":"common-library/storage/globalOptions/#subpathexpr","title":"subPathExpr","text":"<p>Use the <code>subPathExpr</code> field to construct <code>subPath</code> directory names from downward API environment variables. See the Kubernetes documentation for more information.</p>"},{"location":"common-library/storage/globalOptions/#advancedmounts","title":"advancedMounts","text":"<p>Explicitly configure mounts for specific controllers and containers.</p> <p>Example</p> <pre><code>advancedMounts:\n  main: # (1)!\n    main: # (2)!\n      - path: /data/config.yaml\n        readOnly: true\n        subPath: config.yaml\n    second-container: # (3)!\n      - path: /appdata/config\n        readOnly: true\n\n  second-controller: # (4)!\n    main: # (5)!\n      - path: /data/config.yaml\n        readOnly: false\n        subPath: config.yaml\n</code></pre> <ol> <li>the controller with the \"main\" identifier</li> <li>the container with the \"main\" identifier</li> <li>the container with the \"second-container\" identifier</li> <li>the controller with the \"second-controller\" identifier</li> <li>the container with the \"main\" identifier</li> </ol>"},{"location":"common-library/storage/globalOptions/#path_1","title":"path","text":"<p>Where to mount the volume in the main container. Defaults to <code>/&lt;name_of_the_volume&gt;</code></p>"},{"location":"common-library/storage/globalOptions/#readonly_1","title":"readOnly","text":"<p>Specify if the volume should be mounted read-only</p>"},{"location":"common-library/storage/globalOptions/#subpath_1","title":"subPath","text":"<p>Specifies a sub-path inside the referenced volume instead of its root.</p>"},{"location":"common-library/storage/globalOptions/#subpathexpr_1","title":"subPathExpr","text":"<p>Use the <code>subPathExpr</code> field to construct <code>subPath</code> directory names from downward API environment variables. See the Kubernetes documentation for more information.</p>"},{"location":"common-library/storage/permissions/","title":"Permissions","text":"<p>Charts do not modify file or folder permissions on volumes out of the box.</p> <p>This means that you will have to make sure that your storage can be written to by the application. Alternatively you can use a <code>initContainer</code> to handle permissions.</p>"},{"location":"common-library/storage/types/configmap/","title":"ConfigMap","text":"<p>In order to mount a configMap to a mount point within the Pod you can use the <code>configMap</code> type persistence item.</p> Field Mandatory Docs / Description <code>name</code> No Which configMap should be mounted. Supports Helm templating. <code>identifier</code> No Reference a configMap from the <code>configMaps</code> key by its identifier. <code>defaultMode</code> No The default file access permission bit. <code>items</code> No Specify item-specific configuration. Will be passed 1:1 to the volumeSpec. <p>Either <code>name</code> or <code>identifier</code> is required.</p> <p>Note</p> <p>Even if not specified, the configMap will be read-only.</p>"},{"location":"common-library/storage/types/configmap/#minimal-configuration","title":"Minimal configuration","text":"<pre><code>persistence:\n  config:\n    enabled: true\n    type: configMap\n    name: mySettings\n</code></pre> <p>This will mount the contents of the pre-existing <code>mySettings</code> configMap to <code>/config</code>.</p>"},{"location":"common-library/storage/types/custom/","title":"Custom","text":"<p>When you wish to specify a custom volume, you can use the <code>custom</code> type. This can be used for example to mount configMap or Secret objects.</p> <p>See the Kubernetes docs for more information.</p> Field Mandatory Docs / Description <code>volumeSpec</code> Yes Define the raw Volume spec here."},{"location":"common-library/storage/types/custom/#minimal-configuration","title":"Minimal configuration","text":"<pre><code>persistence:\n  config:\n    enabled: true\n    type: custom\n    volumeSpec:\n      downwardAPI:\n        items:\n          - path: \"labels\"\n            fieldRef:\n              fieldPath: metadata.labels\n          - path: \"annotations\"\n            fieldRef:\n              fieldPath: metadata.annotations\n</code></pre>"},{"location":"common-library/storage/types/emptyDir/","title":"Empty Dir","text":"<p>Sometimes you need to share some data between containers, or need some scratch space. That is where an emptyDir can come in.</p> <p>See the Kubernetes docs for more information.</p> Field Mandatory Docs / Description <code>medium</code> No Set this to <code>Memory</code> to mount a tmpfs (RAM-backed filesystem) instead of the storage medium that backs the node. <code>sizeLimit</code> No If the <code>SizeMemoryBackedVolumes</code> feature gate is enabled, you can specify a size for memory backed volumes."},{"location":"common-library/storage/types/emptyDir/#minimal-configuration","title":"Minimal configuration","text":"<pre><code>persistence:\n  config:\n    enabled: true\n    type: emptyDir\n</code></pre> <p>This will create an ephemeral emptyDir volume and mount it to <code>/config</code>.</p>"},{"location":"common-library/storage/types/hostPath/","title":"Host path","text":"<p>In order to mount a path from the node where the Pod is running you can use a <code>hostPath</code> type persistence item.</p> <p>This can also be used to mount an attached USB device to a Pod. Note that this will most likely also require setting an elevated <code>securityContext</code>.</p> <p>See the Kubernetes docs for more information.</p> Field Mandatory Docs / Description <code>hostPath</code> Yes Which path on the host should be mounted. <code>hostPathType</code> No Specifying a hostPathType adds a check before trying to mount the path. See Kubernetes documentation for options."},{"location":"common-library/storage/types/hostPath/#minimal-configuration","title":"Minimal configuration","text":"<pre><code>persistence:\n  config:\n    enabled: true\n    type: hostPath\n    hostPath: /dev\n</code></pre> <p>This will mount the <code>/dev</code> folder from the underlying host to <code>/dev</code> in the container.</p>"},{"location":"common-library/storage/types/image/","title":"Image","text":"<p>Warning</p> <p>IMPORTANT This feature requires Kubernetes version &gt;= 1.33 and a compatible container runtime!</p> <p>When you want to mount the contents of an OCI object (a container image or artifact) you will want to use the <code>image</code> persistence type.</p> <p>See the Kubernetes docs for more information.</p> Field Mandatory Docs / Description <code>image</code> Yes OCI artifact reference to be used. <code>pullPolicy</code> No Configure the image pull behavior."},{"location":"common-library/storage/types/image/#minimal-configuration","title":"Minimal configuration","text":"<pre><code>persistence:\n  config:\n    type: image\n    image: quay.io/crio/artifact:v2\n</code></pre> <p>This will create an image volume based on the <code>quay.io/crio/artifact:v2</code> OCI artifact and mount it to <code>/config</code>.</p>"},{"location":"common-library/storage/types/nfs-share/","title":"NFS Share","text":"<p>To mount an NFS share to your Pod you can either pre-create a persistentVolumeClaim referring to it, or you can specify an inline NFS volume:</p> <p>Note</p> <p>Mounting an NFS share this way does not allow for specifying mount options. If you require these, you must create a PVC to mount the share.</p> Field Mandatory Docs / Description <code>server</code> Yes Host name or IP address of the NFS server. <code>path</code> Yes The path on the server to mount."},{"location":"common-library/storage/types/nfs-share/#minimal-configuration","title":"Minimal configuration","text":"<pre><code>persistence:\n  config:\n    enabled: true\n    type: nfs\n    server: 10.10.0.8\n    path: /tank/nas/library\n</code></pre> <p>This will mount the NFS share <code>/tank/nas/library</code> on server <code>10.10.0.8</code> to <code>/config</code>.</p>"},{"location":"common-library/storage/types/persistentVolumeClaim/","title":"Persistent Volume Claim","text":"<p>This is probably the most common storage type, therefore it is also the default when no <code>type</code> is specified.</p> <p>It can be attached in two ways.</p> <ul> <li>Dynamically provisioned</li> <li>Existing claim</li> </ul>"},{"location":"common-library/storage/types/persistentVolumeClaim/#dynamically-provisioned","title":"Dynamically provisioned","text":"<p>Charts can be configured to create the required persistentVolumeClaim manifests on the fly.</p> Field Mandatory Docs / Description <code>accessMode</code> Yes link <code>size</code> Yes link <code>nameOverride</code> No Override the name suffix that is used for this volume. <code>storageClass</code> No Storage class to use for this volume. <code>retain</code> No Set to true to retain the PVC upon <code>helm uninstall</code>."},{"location":"common-library/storage/types/persistentVolumeClaim/#minimal-configuration","title":"Minimal configuration","text":"<pre><code>persistence:\n  config:\n    enabled: true\n    type: persistentVolumeClaim\n    accessMode: ReadWriteOnce\n    size: 1Gi\n</code></pre> <p>This will create a 1Gi RWO PVC named <code>RELEASE-NAME-config</code> with the default storageClass, which will mount to <code>/config</code>.</p>"},{"location":"common-library/storage/types/persistentVolumeClaim/#existing-claim","title":"Existing claim","text":"<p>Charts can be configured to attach to a pre-existing persistentVolumeClaim.</p> Field Mandatory Docs / Description <code>existingClaim</code> Yes Name of the existing PVC <code>nameOverride</code> No Override the name suffix that is used for this volume."},{"location":"common-library/storage/types/persistentVolumeClaim/#minimal-configuration_1","title":"Minimal configuration","text":"<pre><code>persistence:\n  config:\n    enabled: true\n    type: persistentVolumeClaim\n    existingClaim: myAppData\n</code></pre> <p>This will mount an existing PVC named <code>myAppData</code> to <code>/config</code>.</p>"},{"location":"common-library/storage/types/secret/","title":"Secret","text":"<p>In order to mount a Secret to a mount point within the Pod you can use the <code>secret</code> type persistence item.</p> Field Mandatory Docs / Description <code>name</code> No Which Secret should be mounted. Supports Helm templating. <code>identifier</code> No Reference a Secret from the <code>secrets</code> key by its identifier. <code>defaultMode</code> No The default file access permission bit. <code>items</code> No Specify item-specific configuration. Will be passed 1:1 to the volumeSpec. <p>Either <code>name</code> or <code>identifier</code> is required.</p> <p>Note</p> <p>Even if not specified, the Secret will be read-only.</p>"},{"location":"common-library/storage/types/secret/#minimal-configuration","title":"Minimal configuration","text":"<pre><code>persistence:\n  config:\n    enabled: true\n    type: secret\n    name: mySecret\n</code></pre> <p>This will mount the contents of the pre-existing <code>mySecret</code> Secret to <code>/config</code>.</p>"},{"location":"common-library/storage/types/vaultDynamicSecret/","title":"vaultDynamicSecret","text":"<p>In order to mount a <code>secret</code> created by <code>vaultDynamicSecret</code> to a mount point within the Pod you can use the <code>vaultDynamicSecret</code> type persistence item.</p> Field Mandatory Docs / Description <code>name</code> No Which <code>vaultDynamicSecret</code> should be mounted. Supports Helm templating. <code>identifier</code> No Reference a <code>vaultDynamicSecret</code> from the <code>vaultDynamicSecret</code> key by its identifier. <code>defaultMode</code> No The default file access permission bit. <code>items</code> No Specify item-specific configuration. Will be passed 1:1 to the volumeSpec. <p>Either <code>name</code> or <code>identifier</code> is required.</p> <p>Note</p> <p>Even if not specified, the Secret will be read-only.</p>"},{"location":"common-library/storage/types/vaultDynamicSecret/#minimal-configuration","title":"Minimal configuration","text":"<pre><code>persistence:\n  secrets:\n    enabled: true\n    type: vaultDynamicSecret\n    name: mySecret\n</code></pre> <p>This will mount the contents of the pre-existing <code>mySecret</code> Secret to <code>/secrets</code>.</p>"},{"location":"common-library/storage/types/vaultStaticSecret/","title":"vaultStaticSecret","text":"<p>In order to mount a <code>secret</code> created by <code>vaultStaticSecret</code> to a mount point within the Pod you can use the <code>vaultStaticSecret</code> type persistence item.</p> Field Mandatory Docs / Description <code>name</code> No Which <code>vaultStaticSecret</code> should be mounted. Supports Helm templating. <code>identifier</code> No Reference a <code>vaultStaticSecret</code> from the <code>vaultStaticSecret</code> key by its identifier. <code>defaultMode</code> No The default file access permission bit. <code>items</code> No Specify item-specific configuration. Will be passed 1:1 to the volumeSpec. <p>Either <code>name</code> or <code>identifier</code> is required.</p> <p>Note</p> <p>Even if not specified, the Secret will be read-only.</p>"},{"location":"common-library/storage/types/vaultStaticSecret/#minimal-configuration","title":"Minimal configuration","text":"<pre><code>persistence:\n  secrets:\n    enabled: true\n    type: vaultStaticSecret\n    name: mySecret\n</code></pre> <p>This will mount the contents of the pre-existing <code>mySecret</code> Secret to <code>/secrets</code>.</p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/","title":"Vault Dynamic Secrets (CRD)","text":"<p>The following options are available for the Vault Dynamic Secrets resource type:</p> <p>You can read more about some of the options on the Hashicorp Vault API docs</p> <p>Example</p> <pre><code>vaultDynamicSecrets:\n  database:\n    mount: database\n    path: creds/database\n    refreshAfter: 30s\n</code></pre>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#enabled","title":"enabled","text":"<p>Enables or disables the creation of the <code>Vault Dynamic Secret</code> resource. This flag automatically sets <code>destination.create: true</code></p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#forcerename","title":"forceRename","text":"<p>Force replace the name of the object. Will also replace the name of <code>destination.name</code></p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#labels","title":"labels","text":"<p>Labels to add to the VaultDynamicSecrets CRD</p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#annotations","title":"annotations","text":"<p>Annotations to add to the VaultDynamicSecrets CRD</p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#vaultauthref","title":"vaultAuthRef","text":"<p>VaultAuthRef to the VaultAuth resource, can be prefixed with a namespace, eg: <code>namespaceA/vaultAuthRefB</code>. If no namespace prefix is provided it will default to namespace of the VaultAuth CR. If no value is specified for VaultAuthRef the Operator will default to the default VaultAuth, configured in the operator's namespace.</p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#namespace","title":"namespace","text":"<p>Namespace to get the secret from in Vault</p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#mount","title":"mount","text":"<p>Mount for the secret in Vault</p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#path","title":"path","text":"<p>Path of the secret in Vault, corresponds to the path parameter for, <code>kv-v1</code> <code>kv-v2</code></p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#requesthttpmethod","title":"requestHTTPMethod","text":"<p>RequestHTTPMethod to use when syncing Secrets from Vault. Setting a value here is not typically required. If left unset the Operator will make requests using the GET method. In the case where Params are specified the Operator will use the PUT method. Please consult https://developer.hashicorp.com/vault/docs/secrets if you are uncertain about what method to use. Of note, the Vault client treats PUT and POST as being equivalent. The underlying Vault client implementation will always use the PUT method.</p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#params","title":"params","text":"<p>Params that can be passed when requesting credentials/secrets. When Params is set the configured RequestHTTPMethod will be ignored. See RequestHTTPMethod for more details. Please consult https://developer.hashicorp.com/vault/docs/secrets if you are uncertain about what 'params' should/can be set to.</p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#renewalpercent","title":"renewalPercent","text":"<p>RenewalPercent is the percent out of 100 of the lease duration when the lease is renewed. Defaults to 67 percent plus jitter.</p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#refreshafter","title":"refreshAfter","text":"<p>RefreshAfter a period of time for VSO to sync the source secret data, in duration notation e.g. 30s, 1m, 24h. This value only needs to be set when syncing from a secret's engine that does not provide a lease TTL in its response. The value should be within the secret engine's configured ttl or max_ttl. The source secret's lease duration takes precedence over this configuration when it is greater than 0.</p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#revoke","title":"revoke","text":"<p>Revoke the existing lease on VDS resource deletion.</p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#allowstaticcreds","title":"allowStaticCreds","text":"<p>AllowStaticCreds should be set when syncing credentials that are periodically rotated by the Vault server, rather than created upon request. These secrets are sometimes referred to as \"static roles\", or \"static credentials\", with a request path that contains \"static-creds\".</p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#rolloutrestartcontrollers","title":"rolloutRestartControllers","text":"<p><code>rolloutRestartControllers</code> should be configured whenever the application(s) consuming the Vault secret does not support dynamically reloading a rotated secret. In that case one, or more RolloutRestartTarget(s) can be configured here. The Operator will trigger a \"rollout-restart\" for each target whenever the Vault secret changes between reconciliation events. See RolloutRestartTarget for more details.</p> <p><code>rolloutRestartControllers</code> currently accepts an array of controllers to automatically reference the <code>name</code> &amp; <code>kind</code>, this will place the found <code>controllers</code> into the <code>RolloutRestartTarget</code> array on the rendered resource.</p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#rolloutrestarttarget","title":"RolloutRestartTarget","text":"<p>see above</p>"},{"location":"common-library/vault-crds/vaultDynamicSecrets/#destination","title":"destination","text":"<p>Destination supports a number of options, <code>create</code> &amp; <code>name</code> are automatically handled by this chart. Find more options here.</p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/","title":"Vault Static Secrets (CRD)","text":"<p>The following options are available for the Vault Static Secrets resource type:</p> <p>You can read more about some of the options on the Hashicorp Vault API docs</p> <p>Example</p> <pre><code>vaultStaticSecrets:\n  secrets:\n    mount: kv\n    type: kv-v2\n    refreshAfter: 5m\n    hmacSecretData: true\n    path: application/app-name/some-secret-path\n</code></pre>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#enabled","title":"enabled","text":"<p>Enables or disables the creation of the <code>Vault Static Secret</code> resource. This flag automatically sets <code>destination.create: true</code></p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#forcerename","title":"forceRename","text":"<p>Force replace the name of the object. Will also replace the name of <code>destination.name</code></p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#labels","title":"labels","text":"<p>Labels to add to the VaultStaticSecrets CRD</p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#annotations","title":"annotations","text":"<p>Annotations to add to the VaultStaticSecrets CRD</p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#vaultauthref","title":"vaultAuthRef","text":"<p>VaultAuthRef to the VaultAuth resource, can be prefixed with a namespace, eg: <code>namespaceA/vaultAuthRefB</code>. If no namespace prefix is provided it will default to namespace of the VaultAuth CR. If no value is specified for VaultAuthRef the Operator will default to the default VaultAuth, configured in the operator's namespace.</p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#namespace","title":"namespace","text":"<p>Namespace to get the secret from in Vault</p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#mount","title":"mount","text":"<p>Mount for the secret in Vault</p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#path","title":"path","text":"<p>Path of the secret in Vault, corresponds to the path parameter for, <code>kv-v1</code> <code>kv-v2</code></p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#type","title":"type","text":"<p>Type of the Vault static secret <code>kv-v1 or kv-v2</code></p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#version","title":"version","text":"<p>Version of the secret to fetch. Only valid for type <code>kv-v2</code>. Corresponds to version query parameter: version</p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#refreshafter","title":"refreshAfter","text":"<p>RefreshAfter a period of time, in duration notation e.g. 30s, 1m, 24h</p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#hmacsecretdata","title":"hmacSecretData","text":"<p>HMACSecretData determines whether the Operator computes the HMAC of the Secret's data. The MAC value will be stored in the resource's Status.SecretMac field, and will be used for drift detection and during incoming Vault secret comparison. Enabling this feature is recommended to ensure that Secret's data stays consistent with Vault.</p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#rolloutrestartcontrollers","title":"rolloutRestartControllers","text":"<p><code>rolloutRestartControllers</code> should be configured whenever the application(s) consuming the Vault secret does not support dynamically reloading a rotated secret. In that case one, or more RolloutRestartTarget(s) can be configured here. The Operator will trigger a \"rollout-restart\" for each target whenever the Vault secret changes between reconciliation events. All configured targets wil be ignored if HMACSecretData is set to false.</p> <p><code>rolloutRestartControllers</code> currently accepts an array of controllers to automatically reference the <code>name</code> &amp; <code>kind</code>, this will place the found <code>controllers</code> into the <code>RolloutRestartTarget</code> array on the rendered resource.</p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#rolloutrestarttarget","title":"RolloutRestartTarget","text":"<p>see above</p>"},{"location":"common-library/vault-crds/vaultStaticSecrets/#destination","title":"destination","text":"<p>Destination supports a number of options, <code>create</code> &amp; <code>name</code> are automatically handled by this chart. Find more options here.</p>"}]}